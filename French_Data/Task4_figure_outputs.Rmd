
---
title: "multi - french"
author: "Imperial College"
---


```{r echo = FALSE}
library(knitr)
opts_chunk$set(fig.path='figs/', fig.keep='high',
               dev=c('png'), fig.width=8, fig.height=5, cache=FALSE,
               tidy=FALSE, warning=FALSE, fig.show="asis"
 	       )

library(ggplot2)

###########################################################################
###########################################################################

# plot 2 d hist of variants Rts

plot2d_hist <- function(x,k){
  sub('-vs-.*', '', names(x)[k])
  sub('.*-vs-', '', names(x)[k])
  ggplot(x[[k]], aes(x,y)) +  
    xlab(paste0('Rt (',sub('-vs-.*', '', names(x)[k]),')')) + 
    ylab(paste0('Rt (',sub('.*-vs-', '', names(x)[k]),')')) +
    stat_bin2d(bins=25) + 
    xlim(0,max(x[[k]])) + ylim(0,max(x[[k]])) +
    scale_fill_gradientn(colours=r) + 
    geom_abline(intercept = 0,slope = 1,col='red3') 
  
}
###########################################################################
###########################################################################
# plot 2d hist 

plot_hist_dist <- function(x, x_sum, keep = FALSE){
  

  p <- q <-list()
  epsi <- list()
  for(k in 1:(ncol(x_sum)-1)){
    # print(k)
    if(sum(x_sum[k+1])>0){
      
      p[[k]] <- plot2d_hist(x = x, k)
      
     
  
  if((ncol(x_sum)-1) == 3){
    gridExtra::grid.arrange(p[[1]],q[[1]],p[[2]],q[[2]],p[[3]],q[[3]],
                            nrow = 3,
                            layout_matrix = matrix(c(1,1,1,2,3,3,3,4,5,5,5,6),
                                                   nrow = 3, ncol = 4,
                                                   byrow = TRUE))
  }else{
    gridExtra::grid.arrange(p[[1]],q[[1]],
                            nrow = 1,
                            layout_matrix = matrix(c(1,1,1,2),
                                                   nrow = 1, ncol = 4,
                                                   byrow = TRUE))
  }
  
  if(keep){
    return(epsi)
  }
}


```

# load data

```{r}
# intial data
Epi_param <- readRDS('Rdata/Epi_param.rds')
I_fr <- readRDS(file = 'Rdata/I_fr.rds')
I_UK1 <- readRDS(file = 'Rdata/I_UK1.rds')
I_UK2 <- readRDS(file = 'Rdata/I_UK2.rds')
periods <- readRDS(file = 'Rdata/periods.rds')

# joint estimate of epsilons
Jestim_fr <- readRDS('Rdata/Jestim_fr.rds')
Jestim_UK1 <- readRDS('Rdata/Jestim_UK1.rds')
Jestim_UK2 <- readRDS('Rdata/Jestim_UK2.rds')

# naive epiestim
Rt_epi_fr <- readRDS('Rdata/Rt_epi_fr.rds')
Rt_epi_UK1 <- readRDS('Rdata/Rt_epi_UK1.rds')
Rt_epi_UK2 <- readRDS('Rdata/Rt_epi_UK2.rds')

# naive epsilon
naive_epsilon_fr <- readRDS( 'Rdata/naive_epsilon_fr.rds')
naive_epsilon_UK1 <- readRDS('Rdata/naive_epsilon_UK1.rds')
naive_epsilon_UK2 <- readRDS('Rdata/naive_epsilon_UK2.rds')

```


# errorbars of epsilons

```{r, epsilons, fig.height=6, fig.width=8}

layout(matrix(1:2,1,2))
#########################################################
#########################################################
# fr
#########################################################
#########################################################

d <- Jestim_fr$epsilon$wild_alpha
d <- purrr::map_df(d, rev)
Hmisc::errbar(x = d$name,
              y = d$med,yplus = d$up,
              yminus = d$low,
              xlab = '',
              ylab = 'epsilon (alpha vs wild)',
              ylim = c(0,3),
              bty = 'n',
              main = 'France')
abline(v = 1,lty = 2, col='red3')
abline(h = 4.5,lty = 2, col='blue3')
abline(h = ncol(I_fr$wild)+3.5,lty = 2, col='blue3')


#########################################################
#########################################################
# uk
#########################################################
#########################################################

d <- Jestim_UK1$epsilon$wild_alpha
d <- purrr::map_df(d, rev)
Hmisc::errbar(x = d$name,
              y = d$med,yplus = d$up,
              yminus = d$low,
              xlab = '',
              ylab = 'epsilon (alpha vs wild)',
              ylim = c(0,3),
              bty = 'n',
              main = 'UK')
abline(v = 1,lty = 2, col='red3')
abline(h = 4.5,lty = 2, col='blue3')
abline(h = ncol(I_UK1$wild)+3.5,lty = 2, col='blue3')

d <- naive_epsilon_UK1$sum_epsilon$wild_alpha
d <- purrr::map_df(d, rev)
Hmisc::errbar(x = d$name,
              y = d$med,yplus = d$up,
              yminus = d$low,
              add=TRUE)
#########################################################

d <- Jestim_fr$epsilon$`wild_beta/gamma`
d <- purrr::map_df(d, rev)
Hmisc::errbar(x = d$name,
              y = d$med,yplus = d$up,
              yminus = d$low,
              xlab = '',
              ylab = 'epsilon (beta/gamma vs wild)',
              ylim = c(0,3),
              bty = 'n',
              main = 'France')
abline(v = 1,lty = 2, col='red3')
abline(h = 4.5,lty = 2, col='blue3')
abline(h = ncol(I_fr$wild)+3.5,lty = 2, col='blue3')


#########################################################

d <- Jestim_UK2$epsilon$alpha_delta
d <- purrr::map_df(d, rev)
Hmisc::errbar(x = d$name,
              y = d$med,yplus = d$up,
              yminus = d$low,
              xlab = '',
              ylab = 'epsilon (alpha vs delta)',
              ylim = c(0,3),
              bty = 'n',
              main = 'UK')
abline(v = 1,lty = 2, col='red3')
abline(h = 4.5,lty = 2, col='blue3')
abline(h = ncol(I_UK2$alpha)+3.5,lty = 2, col='blue3')

```


# heatmap of Rts

```{r, heatmap_Rts}




```


# Supplemantary figures

## incidence

```{r, SI_incidence}


```


## Rts

```{r, SI_Rts}

```

